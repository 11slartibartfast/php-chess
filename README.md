## PGN Chess for PHP

This is a simple, friendly, and powerful PGN (Portable Game Notation) library for running chess games from within PHP applications. It understands the rules of chess, and is capable of validating and playing PGN notated games.

PGN Chess comes to the rescue in the following scenarios:

- Develop APIs on the server side for validating chess games
- Create funny, random games for fun
- Analyze games of chess
- Build chess-related web apps
- Play chess moves

### 1. Usage

The following examples show how to use PGN Chess.

`pgn-chess/examples/game01.php`

```php
<?php

$game = <<<EOT
    1. d4 d6 2. c4 g6 3. Nc3 Bg7 4. e4 e6 5. Nf3 Ne7 6. Bd3 O-O 7. Qc2 Nd7
    8. O-O-O c5 9. d5 exd5 10. exd5 Ne5 11. Nxe5 Bxe5 12. f4 Bd4+ 13. Kh1 Nf5
    14. Rf3 Nh4 15. Rg3 Bf2 16. Qxf2 Re8
EOT;

include 'print-game.php';
```

`pgn-chess/examples/game02.php`

```php
<?php

$game = <<<EOT
    1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. Nc3 d6 6. d3 b5 7. Bb3 Be7
    8. Be3 Na5 9. Bd5 Nxd5 10. Nxd5 c5 11. Nxe7 Qxe7 12. O-O Nc6 13. Bg5 f6
    14. Be3 O-O 15. h3 Be6 16. Qd2 Nd4 17. Nh4 Qd7 18. Kh2 g5 19. c3 Nc6
    20. Nf3 g4 21. hxg4 Bxg4 22. Nh4 Kh8 23. Bh6 Rg8 24. f4 Bh5 25. fxe5 fxe5
    26. Nf5 Bg6 27. d4 Bxf5 28. Rxf5 cxd4 29. cxd4 Nxd4 30. Rf6 Rg6
    31. Raf1 Rag8 32. Rf8 Ne6 33. Rxg8+ Kxg8 34. Qf2 Rxh6+ 35. Kg1 Nf4
    36. Qb6 Rg6 37. Qb8+ Kg7 38. Rxf4 exf4
EOT;

include 'print-game.php';
```

The `print-game.php` file looks as follows:

```php
<?php
use PGNChess\Board;
use PGNChess\PGN;

require_once __DIR__ . '/../vendor/autoload.php';

$pairs = array_filter(preg_split('/[0-9]+\./', $game));
$moves = [];

foreach ($pairs as $pair)
{
    $moves[] = array_values(array_filter(explode(' ', $pair)));
}

$moves = array_values(array_filter($moves));

$board = new Board;

for ($i=0; $i<count($moves); $i++)
{
    $whiteMove = str_replace("\r", '', str_replace("\n", '', $moves[$i][0]));
    if (isset($moves[$i][1]))
    {
        $blackMove = str_replace("\r", '', str_replace("\n", '', $moves[$i][1]));
    }
    try
    {
        if ($board->play(PGN::objectizeMove(PGN::COLOR_WHITE, $whiteMove)))
        {
            echo PGN::COLOR_WHITE . " played {$whiteMove}, OK..." . PHP_EOL;
        }
        else
        {
            echo PGN::COLOR_WHITE . " played {$whiteMove}, illegal move." . PHP_EOL;
            exit;
        }
        if (isset($moves[$i][1]))
        {
            if ($board->play(PGN::objectizeMove(PGN::COLOR_BLACK, $blackMove)))
            {
                echo PGN::COLOR_BLACK . " played {$blackMove}, OK..." . PHP_EOL;
            }
            else
            {
                echo PGN::COLOR_BLACK . " played {$blackMove}, illegal move." . PHP_EOL;
                exit;
            }
        }
    }
    catch (\InvalidArgumentException $e)
    {
        echo $e->getMessage() . PHP_EOL;
        exit;
    }
}
```

As you see, the call to the `$board->play` method returns `true` or `false` depending on whether or not a chess move can be run on the board. It is up to you to process the result accordingly.

This is the output obtained when running `game01.php`:

    $ php game01.php
    w played d4, OK...
    b played d6, OK...
    w played c4, OK...
    b played g6, OK...
    w played Nc3, OK...
    b played Bg7, OK...
    w played e4, OK...
    b played e6, OK...
    w played Nf3, OK...
    b played Ne7, OK...
    w played Bd3, OK...
    b played O-O, OK...
    w played Qc2, OK...
    b played Nd7, OK...
    w played O-O-O, illegal move.

In this particular example we're printing the output and exiting the game if an illegal chess move is found. But obviously you can take a different approach, for example go into a loop till the player runs a valid move. Again, it is up to you how to process the moves accordingly -- ask the player to please try again, play a sound, exit the game or whatever thing you consider appropriate. The important thing is that PGN Chess understands chess rules, internally replicating the game being played on the board.

Let's look at another example, the output generated by `game02.php`:

    $ php game02.php
    w played e4, OK...
    b played e5, OK...
    w played Nf3, OK...
    b played Nc6, OK...
    w played Bb5, OK...
    b played a6, OK...
    w played Ba4, OK...
    b played Nf6, OK...
    w played Nc3, OK...
    b played d6, OK...
    w played d3, OK...
    b played b5, OK...
    w played Bb3, OK...
    b played Be7, OK...
    w played Be3, OK...
    b played Na5, OK...
    w played Bd5, OK...
    b played Nxd5, OK...
    w played Nxd5, OK...
    b played c5, OK...
    w played Nxe7, OK...
    b played Qxe7, OK...
    w played O-O, OK...
    b played Nc6, OK...
    w played Bg5, OK...
    b played f6, OK...
    w played Be3, OK...
    b played O-O, OK...
    w played h3, OK...
    b played Be6, OK...
    w played Qd2, OK...
    b played Nd4, OK...
    w played Nh4, OK...
    b played Qd7, OK...
    w played Kh2, OK...
    b played g5, OK...
    w played c3, OK...
    b played Nc6, OK...
    w played Nf3, OK...
    b played g4, OK...
    w played hxg4, OK...
    b played Bxg4, OK...
    w played Nh4, OK...
    b played Kh8, OK...
    w played Bh6, OK...
    b played Rg8, OK...
    w played f4, OK...
    b played Bh5, OK...
    w played fxe5, OK...
    b played fxe5, OK...
    w played Nf5, OK...
    b played Bg6, OK...
    w played d4, OK...
    b played Bxf5, OK...
    w played Rxf5, OK...
    b played cxd4, OK...
    w played cxd4, OK...
    b played Nxd4, OK...
    w played Rf6, OK...
    b played Rg6, OK...
    w played Raf1, OK...
    b played Rag8, OK...
    w played Rf8, OK...
    b played Ne6, OK...
    w played Rxg8+, OK...
    b played Kxg8, OK...
    w played Qf2, OK...
    b played Rxh6+, OK...
    w played Kg1, OK...
    b played Nf4, OK...
    w played Qb6, OK...
    b played Rg6, OK...
    w played Qb8+, OK...
    b played Kg7, OK...
    w played Rxf4, OK...
    b played exf4, OK...
